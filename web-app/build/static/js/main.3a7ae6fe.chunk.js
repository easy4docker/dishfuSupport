(this["webpackJsonpweb-app"]=this["webpackJsonpweb-app"]||[]).push([[0],{201:function(e,t,a){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(a(0)),s=a(273),i=n(a(274));t.default=function(e){var t=e.width,a=e.height,n=e.onUpdate,r=c.default.useRef(null),o=new s.BrowserMultiFormatReader,u=c.default.useCallback((function(){var e,t=null===(e=null===r||void 0===r?void 0:r.current)||void 0===e?void 0:e.getScreenshot();t&&o.decodeFromImage(void 0,t).then((function(e){n(null,e)})).catch((function(e){n(e)}))}),[o,n]);return c.default.useEffect((function(){setInterval(u,100)}),[]),c.default.createElement(i.default,{width:t,height:a,ref:r,screenshotFormat:"image/png",videoConstraints:{facingMode:"environment"}})}},207:function(e,t,a){},263:function(e,t){},271:function(e,t,a){},275:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),s=a(97),i=a.n(s),r=(a(207),a(16)),o=a(40),u=a(35),l=a(283),d=a(277),h=a(284),j=a(29),f=a.n(j),b=a(41);var p=a(47),x=a(1),O=function(e){var t=e.message,a=e.title,n=e.className;return Object(x.jsxs)(d.a,{className:n+" rounded p-3 message-box grid-bg",children:[Object(x.jsx)("b",{style:{textTransform:"capitalize"},children:a}),Object(x.jsx)("h3",{className:"text-secondary m-3 p-3",children:t})]})},m=a(163),g=a(159),v=a(194),S=a(148),y={ready:!1,loading:{},screenModel:{},_watcher:"",fp:"",data:{isAuth:!1,authInfo:{}},config:function(){var e=window.location.hostname,t=window.location.protocol,a="localhost"===e||/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(e)?{apiServer:t+"//"+e+":3001/api",webServer:t+"//"+e+":3006",sockerServer:t+"//"+e+":3001/dishFu",ipfsServer:t+"//gateway.ipfs.io/ipfs/",routeService:"https://dishFu.com/_service_/"}:{apiServer:t+"//"+e+"/api",webServer:t+"//"+e,sockerServer:t+"//"+e+"/dishFu",ipfsServer:t+"//gateway.ipfs.io/ipfs/",routeService:"https://dishFu.com/_service_/"};return"localhost"!==e&&"127.0.0.1"!==e||fetch(a.apiServer+"/getMainIp",{}).then((function(e){return e.json()})).then((function(e,t){console.log(e),window.location=window.location.protocol+"//"+e.data+":3006"})).catch((function(e){})),a}()},w=Object(g.createStore)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(e._watcher="",t.type){case"updateSigninForm":return e.data.signinForm=t.data,e._watcher="auth",N(e.data),e;case"saveAuthInfo":return e.data.authInfo=t.authInfo,e.data.isAuth=!0,e._watcher="forceAuth",N(e.data),e;case"signOff":return e.data.authInfo={},e.data.isAuth=!1,e._watcher="forceAuth",N(e.data),e;case"loadScreenModel":return e.screenModel=t.screenModel,e;case"addLoading":return e._watcher="loading",e.loading[t.id]=(new Date).getTime(),e;case"removeLoading":return e._watcher="loading",delete e.loading[t.id],e;case"initStore":return e.data=t.data,e.fp=t.fp,e._watcher="afterInit",e;default:return e}}),Object(v.composeWithDevTools)()),N=function(e){setTimeout((function(){localStorage.setItem("localSettingData",JSON.stringify(e))}),500)};(function(){var e=Object(b.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S.a.load().then((function(e){return e.get()})).then((function(e){e.visitorId;var a="localSettingData",n=y.data;try{n=localStorage.getItem(a)?JSON.parse(localStorage.getItem(a)):y.data}catch(c){}"function"===typeof t&&t(n,e.visitorId)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}})()((function(e,t){w.dispatch({type:"initStore",data:e,fp:t})}));var k=w;var I=function(e){var t=e.roles,a=e.exroles,c=e.comp,s=e.showException,i=Object(n.useState)([]),o=Object(r.a)(i,2),u=o[0],l=o[1],d=a||[],h=t.filter((function(e){return[].concat(Object(m.a)(u),["all"]).includes(e)})),j=d.filter((function(e){return Object(m.a)(u).includes(e)})),f=function(){l(k.getState().data.authInfo&&k.getState().data.authInfo.roles?k.getState().data.authInfo.roles:[])};Object(n.useEffect)((function(){var e=k.subscribe((function(){"role"!==k.getState()._watcher&&"auth"!==k.getState()._watcher||f()}));return f(),function(){e()}}),[]);var b=Object(x.jsx)("div",{className:"p-3",children:Object(x.jsx)(O,{message:"Missing required roles"})});return!h.length||j.length?s?b:"":c},T=a(278);function M(){var e=Object(n.useState)(0),t=Object(r.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){var e=k.subscribe((function(){"loading"===k.getState()._watcher&&c(Object.keys(k.getState().loading).length)}));return function(){e()}}),[]),Object(x.jsx)("div",{className:a?"loading":"no-loading",children:Object(x.jsx)(T.a,{animation:"border",size:"md",className:"loading-text"})})}var A=function e(t){var a=this;Object(p.a)(this,e),this.loadingOn=function(){k.dispatch({type:"addLoading",id:a.id})},this.loadingOff=function(){k.dispatch({type:"removeLoading",id:a.id})},this.fetchApi=function(){var e=Object(b.a)(f.a.mark((function e(t,n){var c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.loadingOn(),c=a,fetch(t.url,{}).then((function(e){return e.json()})).then((function(e,t){200===e.status?(c.loadingOff(),n(e.data)):c.loadingOff()})).catch((function(e){c.loadingOff()}));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.updateSigninForm=function(e,t,a){k.dispatch({type:"updateSigninForm",data:{token:e,phone:a,socketid:t}})},this.DatabaseApi=function(e,t,n){fetch(a.server+"/"+e,{method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){n(e)})).catch((function(e){n({status:"failure",message:e.message})}))},this.id=(new Date).getTime(),this.defaultData={recipes:[],plates:[],orders:[],menus:[],focuses:[]},this.server=k.getState().config.apiServer},_=(a(160),function e(t){var a=this;Object(p.a)(this,e),this.load=Object(b.a)(f.a.mark((function e(){var t,n,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S.a.load(),e.next=3,t;case 3:return n=e.sent,e.next=6,n.get();case 6:return c=e.sent,a.visitorId=c.visitorId,e.abrupt("return",a.visitorId);case 10:case"end":return e.stop()}}),e)}))),this.visitorId=null}),F=a(282);a(279),a(196),a(195);function C(e){return Object(x.jsx)(d.a,{className:"bg-info",fluid:!0,children:Object(x.jsx)(d.a,{children:Object(x.jsxs)(h.a,{expand:"lg",className:"p-1",children:[Object(x.jsx)(h.a.Brand,{href:"",children:Object(x.jsx)(E,{})}),Object(x.jsx)(h.a.Brand,{className:"menu-color",children:e.comp})]})})})}function E(){return Object(x.jsxs)("div",{className:"border rounded p-1 m-0",style:{color:"yellow",fontSize:"1.5rem"},children:["\u83dc\u8b5c",Object(x.jsx)("span",{className:"ml-1",style:{fontSize:"1rem"},children:"SupportCenter"})]})}var D=a(280);var z=a(111),R=a(91);function q(e){var t=Object(n.useState)(!1),a=Object(r.a)(t,2),c=(a[0],a[1]);return Object(n.useEffect)((function(){var e=k.subscribe((function(){return"auth"===k.getState()._watcher&&c(k.getState().data.auth),!1}));return c(k.getState().data.auth),function(){e()}}),[]),Object(x.jsx)("div",{className:"rounded p-1 m-0",style:{fontSize:"1.1rem"},children:Object(x.jsxs)("span",{className:"menu-color",onClick:function(){k.dispatch({type:"signOff"})},children:[Object(x.jsx)(z.a,{size:"1x",icon:R.a,className:"mr-1"})," Sign off"]})})}var L=a(285),$=a(144),B=a.n($),P=a(145),U=a.n(P);function Q(e){var t=k.getState().config.sockerServer,a=k.getState().config.webServer,c=Object(n.useState)(""),s=Object(r.a)(c,2),i=s[0],o=s[1],u=Object(n.useState)(""),l=Object(r.a)(u,2),h=l[0],j=l[1];Object(n.useEffect)((function(){var e=function(e){var a=U.a.connect(t);return console.log("===SOCKET_URL==="+t),a.on("connect",(function(){console.log("===socket-connected==="+a.id);var t=a.id.replace("/dishFu#","");a.on("afterTransfer",(function(e,t){"sendAuthInfo"===t.action&&(k.dispatch({type:"saveAuthInfo",authInfo:t.data}),a.disconnect())})),e&&e(t)})),a.on("disconnect",(function(){})),a}((function(e){o(a+"/crossFromMobile/"+e)}));return function(){e.disconnect(),console.log("cleaned up ===  disconnexted === ")}}),[]),Object(n.useEffect)((function(){f()}),[i]);var f=function(){B.a.toDataURL(i,{width:338,type:"image/png",quality:1,color:{dark:"#000000",light:"#0000"}},(function(e,t){return j(t)}))};return Object(x.jsxs)(L.a,{variant:"secondary",children:[Object(x.jsx)(L.a.Heading,{className:"p-3",children:"Please scan the QR code to signin -- "}),Object(x.jsxs)(d.a,{fluid:!0,children:[i,Object(x.jsx)("br",{}),h&&Object(x.jsx)(D.a,{src:h,className:"border border-primary"})]})]})}var J=a(281);function H(e){var t=Object(u.f)(),a=new A,c=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,s=k.getState().config.sockerServer,i=Object(n.useState)(e.isAuth),o=Object(r.a)(i,2),l=o[0],h=(o[1],Object(n.useState)("")),j=Object(r.a)(h,2),f=j[0],b=j[1],p=Object(n.useState)(""),O=Object(r.a)(p,2),m=O[0],g=O[1],v=Object(u.h)();Object(n.useEffect)((function(){}),[]);var S=function(e){return Object(x.jsxs)(d.a,{fluid:!0,className:"m-0 p-0",children:[Object(x.jsx)(C,{comp:""}),Object(x.jsx)(d.a,{children:Object(x.jsxs)(L.a,{variant:e.variant?e.variant:"light mt-3",children:[Object(x.jsx)(L.a.Heading,{children:e.title}),e.body]})})]})},y=Object(x.jsx)(S,{title:"QR Code captured",body:Object(x.jsxs)(d.a,{fluid:!0,children:[Object(x.jsx)(F.a.Text,{className:"center text-secondary h5 p-0",children:"Click the Yes button to authorize the desktop application from this phone."}),Object(x.jsx)(J.a,{onClick:function(){var e=U.a.connect(s);e.on("connect",(function(){var a=e.id.replace("/dishFu#","");e.emit("transfer",v.token,a,{action:"sendAuthInfo",data:k.getState().data.authInfo}),e.disconnect(),t.push("/SuccessInfo/crossFromMobile/success")}))},style:{width:"100%"},className:"btn btton-warning",children:"Yes, continue"}),Object(x.jsx)(F.a.Text,{className:"center text-secondary h5 p-1",children:"If it is not your expectd process. please click stop button to skip that authentication process"}),Object(x.jsx)(J.a,{onClick:function(){t.push("/SuccessInfo/crossFromMobile/stop")},style:{width:"100%"},variant:"danger",className:"m-2",children:"Stop the authentication"}),Object(x.jsx)(F.a.Text,{className:"center text-secondary h5 p-1",children:"It is wrong. please click Remove button to remove that authentication from the phone."}),Object(x.jsx)(J.a,{onClick:function(){k.dispatch({type:"signOff"}),t.push("/SuccessInfo/linkMobile/"+(new Date).getTime())},style:{width:"100%"},variant:"warning",className:"m-2",children:"Remove the authentication"})]})}),w=Object(x.jsx)(S,{title:"Request authentication:",body:Object(x.jsxs)(d.a,{className:"p-3",children:[Object(x.jsxs)(F.a.Group,{className:"p-2",children:[Object(x.jsx)(F.a.Label,{children:"Your phone number"}),Object(x.jsx)(F.a.Control,{defaultValue:f,placeholder:"(xxx)xxx-xxxx",type:"text",style:{fontSize:"1.8rem"},onChange:function(e){c.test(e.target.value)?(e.target.value=e.target.value.replace(c,"($1)$2-$3"),b(e.target.value.replace(c,"($1)$2-$3"))):b("")}})]}),Object(x.jsx)(F.a.Group,{className:"p-3",children:!!f&&Object(x.jsx)(J.a,{className:"btn btn-info",onClick:function(){a.loadingOn(),g(""),a.DatabaseApi("admin",{action:"checkPhone",data:{token:v.token,visitorId:k.getState().fp,phone:f.replace(c,"$1$2$3")}},(function(e){a.loadingOff(),"success"===e.status?t.push("/SuccessInfo/phone/"+f):g(e.message)}))},style:{width:"100%"},children:"Submit"})}),Object(x.jsx)(F.a.Text,{className:"text-danger text-center",children:Object(x.jsx)("h3",{children:m})})]})});return l?y:w}function Y(e){var t=Object(u.h)(),a={};switch(t.code){case"phone":a={header:"Success submitted!",title:"",body:"The authentication request has been sent to ".concat(t.id,". A text message is coming!")};break;case"linkMobile":var n=Object(x.jsxs)(d.a,{className:"p-1 text-center",children:[Object(x.jsx)(F.a.Text,{className:"text-secondary h4 p-3 mt-3",children:"keepExist"===t.id?"Nothing changed":"Authentication placed"}),Object(x.jsx)(z.a,{size:"9x",icon:R.b,className:"text-success"}),Object(x.jsx)(F.a.Text,{className:"text-success h4 p-3 mt-3 mb-3",children:"The equipment is authrized"}),Object(x.jsx)(F.a.Text,{className:"text-success h4 p-0 m-3",children:Object(x.jsx)(J.a,{className:"btn btn-warning mt-3",onClick:function(){k.dispatch({type:"signOff"})},children:"Remove the authentication"})})]}),c=Object(x.jsxs)(d.a,{className:"p-3 mt-3 text-center",children:[Object(x.jsx)(F.a.Text,{className:"text-secondary h4 p-3 mt-3",children:"failure"===t.id?"Invalid or expired link.":""}),Object(x.jsx)(z.a,{size:"9x",icon:R.c,className:"text-danger"}),Object(x.jsx)(F.a.Text,{className:"text-danger h4 p-3 mt-3",children:"The equipment is not authrized"})]});a={header:"",title:"",body:e.isAuth?n:c};break;case"crossFromMobile":a={header:"",title:"",body:Object(x.jsxs)(d.a,{fluid:!0,className:"p-3",children:[Object(x.jsx)(F.a.Text,{className:"text-info h4 p-3",children:"success"===t.id?"Succeess!":"stop"===t.id?"Stopped!":""}),Object(x.jsx)(F.a.Text,{className:"text-info h4 p-3",children:"success"===t.id?"The authentication has been issued to the target desktop application.":"stop"===t.id?"No worry. The mobile authentication did not go through!":""})]})};break;default:a={header:"nothing",title:"nothing",body:"nothing"}}return Object(x.jsxs)(d.a,{fluid:!0,className:"m-0 p-0",children:[Object(x.jsx)(C,{comp:a.title}),Object(x.jsx)(d.a,{children:Object(x.jsxs)(L.a,{variant:"light mt-3",children:[Object(x.jsx)(L.a.Heading,{children:a.header}),a.body]})})]})}function G(e){var t=Object(u.f)(),a=new A,c=Object(n.useState)(null),s=Object(r.a)(c,2),i=s[0],o=s[1],l=Object(n.useState)(""),h=Object(r.a)(l,2),j=h[0],f=h[1],b=Object(u.h)();Object(n.useEffect)((function(){o(!e.isAuth)}),[]),Object(n.useEffect)((function(){i&&(a.loadingOn(),a.DatabaseApi("admin",{action:"getAdminSessionRecord",data:{recid:b.recid,token:b.token}},(function(e){a.loadingOff(),"failure"===e.status?f(e.message):e.data&&e.data.length?(k.dispatch({type:"saveAuthInfo",authInfo:e.data[0]}),t.push("/SuccessInfo/linkMobile/success")):t.push("/SuccessInfo/linkMobile/failure")})))}),[i]);var p=function(e){return Object(x.jsxs)(d.a,{fluid:!0,className:"m-0 p-0",children:[Object(x.jsx)(C,{comp:""}),Object(x.jsx)(d.a,{children:Object(x.jsxs)(L.a,{variant:e.variant?e.variant:"light mt-3",className:"text-primary",children:[Object(x.jsx)(L.a.Heading,{children:e.title}),e.body]})})]})},O=Object(x.jsx)(p,{title:"",body:Object(x.jsxs)(d.a,{fluid:!0,children:[Object(x.jsx)(F.a.Text,{className:"text-secondary h4 p-2 text-center mb-3 mt-3",children:"The equipment has been authrized. Would you like to continue?"}),Object(x.jsx)(J.a,{className:"btn btn-warning mt-3 mb-2",onClick:function(){o(!0)},style:{width:"100%"},children:"Continue anyway"}),Object(x.jsx)(J.a,{className:"btn btn-info mt-3",onClick:function(){o(!1),t.push("/SuccessInfo/linkMobile/keepExist")},style:{width:"100%"},children:"No, keep exist one."})]})}),m=Object(x.jsx)(p,{title:"",body:Object(x.jsx)(d.a,{fluid:!0,children:Object(x.jsxs)(F.a.Text,{className:"text-danger h4 p-2",children:[Object(x.jsx)("b",{children:"Data Error ! "}),Object(x.jsx)("br",{}),j]})})});return j?m:i?"":O}var W=function(e){var t=Object(n.useState)(""),a=Object(r.a)(t,2),c=a[0],s=a[1],i={authUsers:{caption:"User Admin",role:["all"],linkTo:"/authUsers"},transTracking:{caption:"Transaction Report",role:["all"],linkTo:"/transReport"}},j=function(e){return Object(u.g)().pathname!==i[e].linkTo?"menu-color":"menu-color-select"},f=function(e){var t=i[e]?i[e]:{role:[]},a=t&&t.role?t.role:[],n=t&&t.exrole?t.exrole:[],c=function(t){return Object(x.jsx)(l.a.Link,{as:o.b,to:t.linkTo,className:j(e),onClick:function(){s(!1)},children:t.caption})}(t);return Object(x.jsx)(I,{roles:a,comp:c,exroles:n})};return Object(n.useEffect)((function(){}),[]),Object(x.jsx)(d.a,{className:"bg-info",fluid:!0,children:Object(x.jsx)(d.a,{children:Object(x.jsxs)(h.a,{expand:"lg",className:"p-1",expanded:c,children:[Object(x.jsx)(h.a.Brand,{as:o.b,to:"/",className:"menu_color",children:Object(x.jsx)(E,{})}),Object(x.jsx)(h.a.Brand,{className:"menu_color",children:Object(x.jsx)(q,{})}),Object(x.jsx)(h.a.Collapse,{id:"basic-navbar-nav",children:Object(x.jsxs)(l.a,{className:"me-auto",children:[f("authUsers"),f("transTracking")]})})]})})})};var K=function(){var e=(new Date).getFullYear();return Object(x.jsxs)(d.a,{fluid:!0,className:"footer",children:[Object(x.jsxs)("div",{className:"float-left alert-secondary footer-tag",children:["\xa9 ",e," Dishfu \xa0 \xa0",Object(x.jsx)(o.b,{to:"/privacy",children:"Privacy"}),"\xa0|\xa0",Object(x.jsx)(o.b,{to:"/terms",children:"Term"})]}),Object(x.jsx)("div",{className:"clearfix p-0 m-0"})]})};a(271);var V=a(99),X=(a(272),a(201)),Z=a.n(X);function ee(){var e=c.a.useState("Not Found"),t=Object(r.a)(e,2),a=t[0],n=t[1];return Object(x.jsxs)("span",{children:["yyy",Object(x.jsx)(Z.a,{width:500,height:500,onUpdate:function(e,t){n(t?t.text:"Not Found")}}),Object(x.jsx)("p",{children:a})]})}var te=function(e){var t=new A,a=(new _,Object(n.useState)(!1)),c=Object(r.a)(a,2),s=c[0],i=c[1],l=Object(n.useState)(!1),h=Object(r.a)(l,2),j=h[0],f=h[1],b={isDesktopOrLaptop:Object(V.useMediaQuery)({query:"(min-width: 1224px)"}),isBigScreen:Object(V.useMediaQuery)({query:"(min-width: 1824px)"}),isTabletOrMobile:Object(V.useMediaQuery)({query:"(max-width: 1224px)"}),isPortrait:Object(V.useMediaQuery)({query:"(orientation: portrait)"}),isRetina:Object(V.useMediaQuery)({query:"(min-resolution: 2dppx)"})},p=function(e){var a=k.getState().data.authInfo;if(!a.authcode)return f(!1),e&&e(),!0;t.loadingOn(),t.DatabaseApi("admin",{action:"checkTokenAuthCode",data:{token:a.token,authcode:a.authcode}},(function(a){t.loadingOff(),"success"===a.status?f(!0):(f(!1),k.dispatch({type:"signOff"})),e&&e()}))};Object(n.useEffect)((function(){j&&p();var e=k.subscribe((function(){return"afterInit"===k.getState()._watcher&&p((function(){i(!0)})),"forceAuth"===k.getState()._watcher&&p(),!1}));return k.dispatch({type:"loadScreenModel",screenModel:b}),function(){e()}}),[]);var O=Object(x.jsx)(C,{comp:Object(x.jsx)(T.a,{animation:"border",size:"md",className:"loading-text"})}),m=Object(x.jsxs)(o.a,{className:"p-0 m-0",children:[Object(x.jsxs)(u.c,{children:[Object(x.jsx)(u.a,{exact:!0,path:"/3Stamps/:code",children:Object(x.jsx)(ee,{isAuth:j})}),Object(x.jsx)(u.a,{exact:!0,path:"/SuccessInfo/:code/:id",children:Object(x.jsx)(Y,{isAuth:j})}),Object(x.jsx)(u.a,{exact:!0,path:"/LinkFromMobile/:recid/:token",children:Object(x.jsx)(G,{isAuth:j})}),Object(x.jsx)(u.a,{exact:!0,path:"/CrossFromMobile/:token",children:Object(x.jsx)(H,{isAuth:j})}),Object(x.jsxs)(u.a,{children:[Object(x.jsx)(W,{}),Object(x.jsx)(d.a,{className:"p-3",children:Object(x.jsx)(Q,{})}),Object(x.jsx)(K,{})]})]}),Object(x.jsx)(M,{})]});return s?m:O},ae=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,286)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),c(e),s(e),i(e)}))};document._cacheExist=!0,i.a.render(Object(x.jsx)(c.a.StrictMode,{children:Object(x.jsx)(te,{})}),document.getElementById("root")),ae()}},[[275,1,2]]]);
//# sourceMappingURL=main.3a7ae6fe.chunk.js.map